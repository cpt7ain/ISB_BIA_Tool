<UserControl x:Class="ISB_BIA_IMPORT1.View.ProcessView_View"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:c="clr-namespace:ISB_BIA_IMPORT1.Converter"
             xmlns:vm="clr-namespace:ISB_BIA_IMPORT1.ViewModel"
             mc:Ignorable="d" 
             d:DesignHeight="700" 
             d:DesignWidth="1200"
             Background="LightSteelBlue"
             DataContext="{Binding Source={StaticResource Locator}, Path=ProcessView}">
    <UserControl.Resources>
        <ResourceDictionary>
            <c:DateToBrushConverter x:Key="DateToBrushConverter"/>
            <c:NumToAlphBinaryConverter x:Key="NumToAlphBinaryConverter"/>
            <c:CritToSignConverter x:Key="CritToSignConverter"/>
            <c:BinaryToBrushConverter x:Key="BinaryToBrushConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition Height="100*"/>
        </Grid.RowDefinitions>
        <Border Grid.ColumnSpan="3">
            <Grid>
                <Label Content="{Binding Str_Header}" Margin="10,0,0,0" FontWeight="Bold" Grid.ColumnSpan="2" VerticalAlignment="Center"/>
                <Button Content="Zurück" Background="Wheat" Grid.Column="3" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,10,0" Command="{Binding Cmd_NavBack}"/>
            </Grid>
        </Border>
        <Border Grid.Row="1" Margin="10" Background="White" BorderBrush="Black" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="70"/>
                    <RowDefinition Height="200*"/>
                    <RowDefinition Height="35"/>
                    <RowDefinition Height="35"/>
                    <RowDefinition Height="35"/>
                    <RowDefinition Height="35"/>
                    <RowDefinition Height="35"/>
                </Grid.RowDefinitions>
                <Grid Grid.ColumnSpan="3">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300*"/>
                        <ColumnDefinition Width="250"/>
                        <ColumnDefinition Width="70"/>
                        <ColumnDefinition Width="120"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" HorizontalAlignment="Left" Margin="10,0,0,0" Text="{Binding Str_Instruction}" VerticalAlignment="Center" TextWrapping="WrapWithOverflow"/>
                    <TextBox Grid.Column="1" Name="SearchBox" Text="" VerticalAlignment="Center" KeyUp="SearchBox_KeyUp"/>
                    <Button Grid.Column="2" Content="Suche" VerticalAlignment="Center" Click="SearchButton_Click" Margin ="0,0,10,0"/>
                    <Button Grid.Column="3" Content="Excel-Export" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="10,0,10,0" Command="{Binding Cmd_ExportList}"/>
                </Grid>
                <DataGrid 
                  Name="ProcessDataGrid"
                  SelectionMode="{Binding SelectionMode}"
                  IsReadOnly="true" 
                  VerticalAlignment="Top" 
                  Grid.Row="1"
                  RowHeaderWidth="0"
                  VerticalGridLinesBrush="LightGray"
                  HorizontalGridLinesBrush="LightGray"
                  AutoGenerateColumns="False"
                  CanUserResizeRows="False" 
                  Grid.ColumnSpan="3" 
                  Grid.Column="0"
                  SelectedItem="{Binding SelectedItem}"         
                  ItemsSource="{Binding List_Processes, IsAsync=True}">
                    <DataGrid.InputBindings>
                        <MouseBinding Gesture="LeftDoubleClick" Command="{Binding Cmd_RowDoubleClick}"/>
                        <KeyBinding Key="Enter" Command="{Binding Cmd_RowDoubleClick}"/>
                    </DataGrid.InputBindings>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="" Width="20" FontWeight="Bold" Foreground="Red" Binding="{Binding Kritischer_Prozess, Converter={StaticResource CritToSignConverter}}"/>
                        <DataGridTextColumn Header="Prozessname" Width="250" Binding="{Binding Prozess}"/>
                        <DataGridTextColumn Header="Sub-Prozessname" Width="250" Binding="{Binding Sub_Prozess}"/>
                        <DataGridTextColumn Header="Zuständige OE" Width="100" Binding="{Binding OE_Filter}"/>
                        <DataGridTextColumn Header="Eigentümer" Width="100" Binding="{Binding Prozesseigentümer}"/>
                        <DataGridTextColumn Header="Verantwortlicher" Width="150" Binding="{Binding Prozessverantwortlicher}"/>
                        <DataGridTextColumn Header="Aktiv" Width="50" Binding="{Binding Aktiv ,Converter={StaticResource NumToAlphBinaryConverter}}"/>
                        <DataGridTextColumn Header="Bearbeitungsdatum" Width="170" Binding="{Binding Datum, StringFormat=\{0:dd.MM.yy HH:mm:ss\}}"/>
                        <DataGridTextColumn Header="Bearbeitet von" Width="100" Binding="{Binding Benutzer}"/>
                    </DataGrid.Columns>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ElementName=g1, Path=Visibility}" Value="Visible">
                                    <Setter Property="Background" Value="{Binding Datum, Converter={StaticResource DateToBrushConverter}}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ElementName=g1, Path=Visibility}" Value="Collapsed">
                                    <Setter Property="Background" Value="{Binding Aktiv, Converter={StaticResource BinaryToBrushConverter}}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
                <Grid Grid.Row="2" Grid.RowSpan="3" Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="10*"/>
                        <RowDefinition Height="10*"/>
                        <RowDefinition Height="10*"/>
                    </Grid.RowDefinitions>
                    <Rectangle Fill="White" Width="50" HorizontalAlignment="Left" Margin="20,10,0,10" Grid.Row="1" Stroke="Black" Grid.Column="0"/>
                    <TextBlock Text="{Binding Count_Edit, StringFormat='Aktive Prozesse: {0}'}" Grid.Row="1" Margin="80,0,0,0" Grid.Column="0" VerticalAlignment="Center"/>
                    <Rectangle Fill="LightSalmon" Width="50" HorizontalAlignment="Left" Margin="20,10,0,10" Grid.Row="2" Stroke="Black" Grid.Column="0"/>
                    <TextBlock Text="{Binding Count_NonEdit, StringFormat='Gelöschte Prozesse: {0}'}" Grid.Row="2" Margin="80,0,0,0" Grid.Column="0" VerticalAlignment="Center"/>
                </Grid>
                <Grid x:Name="g1" Grid.Row="2" Grid.RowSpan="3" Visibility="{Binding Vis_ButtonMultiSave}" Background="White">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="10*"/>
                        <RowDefinition Height="10*"/>
                        <RowDefinition Height="10*"/>
                    </Grid.RowDefinitions>
                    <Button CommandParameter="{Binding ElementName=ProcessDataGrid, Path=SelectedItems}" Margin="20,0,0,0" Command="{Binding Cmd_SaveSelectedItems}"  Content="Ausgewählte Prozesse speichern" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                    <Rectangle Fill="White" Width="50" HorizontalAlignment="Left" Margin="20,10,0,10" Grid.Row="1" Stroke="Black" Grid.Column="0"/>
                    <TextBlock Text="{Binding Count_NonEdit, StringFormat='Noch nicht bearbeitete Prozesse: {0}'}" Grid.Row="1" Margin="80,0,0,0" Grid.Column="0" VerticalAlignment="Center"/>
                    <Rectangle Fill="LightGreen" Width="50" HorizontalAlignment="Left" Margin="20,10,0,10" Grid.Row="2" Stroke="Black" Grid.Column="0"/>
                    <TextBlock Text="{Binding Count_Edit, StringFormat='Bearbeitete Prozesse: {0}'}" Grid.Row="2" Margin="80,0,0,0" Grid.Column="0" VerticalAlignment="Center"/>
                </Grid>
                <TextBlock Text="{Binding List_Processes.Count, StringFormat='Gesamt: {0}'}" Grid.Row="5" VerticalAlignment="Center" Margin="80,0,0,0"/>
                <TextBlock Text="!" FontWeight="Bold" Foreground="Red" Grid.Row="6" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="45,0,0,0"/>
                <TextBlock Text="{Binding Count_Crit, StringFormat='Kritische Prozesse: {0}'}" Grid.Row="6" VerticalAlignment="Center" Margin="80,0,0,0"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
